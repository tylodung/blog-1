<!doctype html>
<html lang="ja" itemscope itemtype="http://schema.org/Blog">
<head>
    <meta charset="utf-8">
  <title>メモログ</title>
  <meta name="description" content="💡 Personal notes about somthing I&#39;m interested in" id="meta-description">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/blog/css/global.css">
  <script>window.lazyLoadOptions = {};</script>
<link rel="stylesheet" href="/blog/css/prism.css" type="text/css">
<link rel="stylesheet" href="/blog/css/prism-line-numbers.css" type="text/css"></head>
<body>
    <header class="header header_component_global">
    <div class="header__title header__title"><a href="/blog/">メモログ</a></div>
    <p class="header__description">💡 Personal notes about somthing I&#39;m interested in</p>
    <aside><blockquote class="header__epigraph">Well, he fuffed, and he puffed, and he huffed and he puffed, and he puffed and huffed; but he could not get the house down.</blockquote></aside>
    <nav class="navigation navigation-global">
      <a href="/blog/" class="navigation__link">📘 Latest Articles</a>
    </nav>
  </header>
  <div class="container">
    <main class="main">
      <article itemprop="blogPost" itemscope itemType="http://schema.org/BlogPosting">
        <header class="header">
          <h1 class="header__title" itemprop="name">weinreでAndroidのWebViewをInspectする</h1>
          <div>
            <time datetime="2013-02-02T04:52:00.000Z" itemprop="datePublished">
              <span class="calendar-icon">📅</span><span>2013年2月2日</span>
            </time>
          </div>
          
        </header>
        <div id="article-content" class="content" itemprop="articleBody"><p>AndroidのWebViewをinspectするという話。調べてたら<a href="http://gihyo.jp/dev/serial/01/phonegap2/0003" target="_blank" rel="noopener">第3回　weinreを使ったiOS／Androidアプリの動作検証：もっと使おうPhoneGap／Cordova 2.0.0｜gihyo.jp … 技術評論社</a>にすでに詳細に書いてあったのでそちらも参考に。<a href="https://hacks.mozilla.org/2013/01/remote-debugging-firefox-os-with-weinre/" target="_blank" rel="noopener">Remote Debugging Firefox OS with Weinre ✩Mozilla Hacks – the Web developer blog</a>の話だと、Firefox OSでも同じようにinspectができるみたい。</p>
<a id="more"></a>
<p>なお、iOSの場合は、<a href="/blog//2012/11/inspect_uiwebview_with_safari/">SafariからUIWebViewのHTMLをinspectする</a>で紹介した方法で簡単にinspectをすることができます（アプリ内のUIWebViewをinspectする場合は、Xcodeでアプリをビルドしないとできません）。</p>
<p>Androidの場合、標準的な方法としては、<a href="https://developers.google.com/chrome-developer-tools/docs/remote-debugging" target="_blank" rel="noopener">Remote Debugging</a>があるのですが、これは携帯端末側のブラウザで開いているページを共有するような感じなので、アプリ内のページをinspectすることができない。あとUSBでの接続が必要。（ちなみにAndoridの4.2では開発者用のオプションは設定のAbout PhoneのBuild numberを7回タップしないと表示されないらしい。）</p>
<p>もう一つの方法として、<a href="http://html.adobe.com/jp/edge/inspect/" target="_blank" rel="noopener">Adobe Edge Inspect</a>を使用するという方法があります。Adobe Edge Inspectではweinreを使用してinspectするので、基本的な操作はweinreと同じですが、複数台の端末を同時に扱えるところが便利（無償版だと1台のみ）。あとweinreでは必要なscriptを埋め込む作業が必要ない。これもありがたい。なので、普通のWebページをinspectする場合はAdobe Edge Inspectがおすすめなのですが、Adobe Edge InspectはPC側のChromeで表示したページを携帯端末側に表示させるため、アプリ内のWebViewを表示することができない。</p>
<p>それで最初の<a href="http://gihyo.jp/dev/serial/01/phonegap2/0003" target="_blank" rel="noopener">第3回　weinreを使ったiOS／Androidアプリの動作検証：もっと使おうPhoneGap／Cordova 2.0.0｜gihyo.jp … 技術評論社</a>に戻るのですが、Androidアプリ内のWebViewをinspectするには自分でweinreを起動してinspectするしかなさそう。</p>
<p>weinreのインストール方法は下記のような感じ。Nodeが必要なのでHomebrewを使って一緒にインストール。Homebrewのインストールは<a href="/blog//2012/09/rvm_jewelrybox_homebrew/">RVM / JewelryBox / Homebrew をインストール</a>を参考。</p>
<pre><code>brew install node
npm -g install weinre
</code></pre><p>HomebrewでインストールしたNode(npm)でweinreをインストールした場合、/usr/local/share/npm/bin/weinre にアプリケーションのエイリアスが作られるのですが、ここはパスが通っていないので、.bash_profileを開いて、PATHの設定を追加（PATH=$PATH:/usr/local/share/npm/bin）。なお、<a href="http://nodejs.org/download/" target="_blank" rel="noopener">Nodeのインストーラー</a>でインストールした場合は、エイリアスが/usr/local/bin/weinreに作られるのでパスを通さなくても大丈夫。これで新しいターミナルを開いて「weinre」と入力するだけで、weinreが起動できます。</p>
<pre><code>weinre
</code></pre><p>weinreは、オプションなしだと<a href="http://localhost:8080/" target="_blank" rel="noopener">localhost:8080</a>で動くので、そこにアクセスすると実際にweinreの画面が確認できます。</p>
<p>しかしlocalhostで動かすと、あとで埋め込む予定のスクリプトに携帯端末からアクセスできなくなります。ので、Wifiで使用しているIPでアドレスを設定します。同じWifiで接続すれば、このIPで携帯端末からでもアクセスが可能になります。</p>
<p>Macの場合、システム環境設定のネットワークの項目で、Wifiに接続済みの場合「状況」の箇所にIPが表示されます（もしくはアプリケーションフォルダのユーティリティから、ネットワークユーティリティを開いて、Wifiのインターフェース情報を確認する）。weinreのオプションについては<a href="http://people.apache.org/~pmuellr/weinre/docs/latest/Running.html" target="_blank" rel="noopener">weinre - Running</a>などを参照。</p>
<pre><code>weinre --boundHost 192.168.0.1(WifiでMacに設定されているIP)
</code></pre><p>そして確認する画面のHTMLに次のようなスクリプトを埋め込む。PhoneGap(Cordova)の場合は、config.xmlに<access origin="192.168.0.1">を加えて、スクリプトへのアクセスを許可する。そしてビルドしなおして端末にインストールする。</access></p>
<pre><code>&lt;script src=&quot;http://192.168.0.1:8080/target/target-script-min.js&quot;&gt;&lt;/script&gt;
</code></pre><p>これで、Android携帯でアプリ画面にアクセスすると、先ほどのweinreの画面で携帯からのアクセスがあったことが分かります。そこから「debug client user interface」のリンクをクリックすると、inspectのための画面(/client)が表示されます。</p>
<p>という感じで、若干手間がかかるのですが、Node/weinreのインストール自体は簡単ですし、Androidの端末上でしか再現しない問題をinspectなしで解決する方がずっと大変なので、それよりはましかなと。</p>
</div>
      </article>
    </main>
  </div>
  <script src="/blog/js/lazysizes/lazysizes.min.js" async></script>
<script type="text/javascript">
  // http://css-tricks.com/favicons-next-to-external-links/
  for (const article of document.getElementsByTagName('article')){
    for (const link of article.getElementsByTagName('a')){
      const hostname = link.hostname;
      if (hostname === location.hostname) { continue; }
      link.style.background = `url(http://www.google.com/s2/favicons?domain=${hostname}) 4px center no-repeat`;
      link.style.paddingLeft = '24px';
    }
  }
</script>
</body>
</html>