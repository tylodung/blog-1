<!doctype html>
<html lang="ja" itemscope itemtype="http://schema.org/Blog">
<head>
    <meta charset="utf-8">
  <title>メモログ</title>
  <meta name="description" content="💡 Personal notes about somthing I&#39;m interested in" id="meta-description">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/blog/css/global.css">
  <script>window.lazyLoadOptions = {};</script>
<link rel="stylesheet" href="/blog/css/prism.css" type="text/css">
<link rel="stylesheet" href="/blog/css/prism-line-numbers.css" type="text/css"></head>
<body>
    <header class="header header_component_global">
    <div class="header__title header__title"><a href="/blog/">メモログ</a></div>
    <p class="header__description">💡 Personal notes about somthing I&#39;m interested in</p>
    <aside><blockquote class="header__epigraph">Well, he fuffed, and he puffed, and he huffed and he puffed, and he puffed and huffed; but he could not get the house down.</blockquote></aside>
    <nav class="navigation navigation-global">
      <a href="/blog/" class="navigation__link">📘 Latest Articles</a>
    </nav>
  </header>
  <div class="container">
    <main class="main">
      <article itemprop="blogPost" itemscope itemType="http://schema.org/BlogPosting">
        <header class="header">
          <h1 class="header__title" itemprop="name">マージンの相殺とoverflow, clear&#x3a;both</h1>
          <div>
            <time datetime="2012-06-04T11:15:00.000Z" itemprop="datePublished">
              <span class="calendar-icon">📅</span><span>2012年6月4日</span>
            </time>
          </div>
          
        </header>
        <div id="article-content" class="content" itemprop="articleBody"><p>垂直方向に隣接するマージンは<a href="http://www.w3.org/TR/CSS21/box#collapsing-margins" target="_blank" rel="noopener">マージンの相殺（collapsing）</a>が働くけれど、overflow:hiddenがあると相殺されない、という仕様の話。あとclearanceについて。</p>
<a id="more"></a>
<pre><code>&lt;style&gt;
.foo {margin:10px 0 20px 0;}
.bar {margin:25px 0 5px 0;}
.baz {margin:20px 0 30px 0;}
&lt;/style&gt;

&lt;h3 class=&quot;foo&quot;&gt;foo&lt;/h3&gt;
&lt;div class=&quot;bar&quot;&gt;
  &lt;p class=&quot;baz&quot;&gt;baz&lt;/p&gt;
&lt;/div&gt;
</code></pre><p>上のようなHTML/CSSの場合、h3.fooのmargin bottomとdiv.barとp.bazのmargin topが、垂直方向に隣接するマージンとなるので相殺の対象となる。その場合、大きい値のマージンが残る。上の例ではdiv.barの25pxのマージンが残る。</p>
<p>マージンの相殺は</p>
<pre><code>&lt;style&gt;
p{ margin:10px; }
&lt;/style&gt;

&lt;p&gt;foo&lt;/p&gt;
&lt;p&gt;bar&lt;/p&gt;
&lt;p&gt;baz&lt;/p&gt;
</code></pre><p>のようなHTML/CSSの場合に、3つのpタグの上下にマージンを入れつつ、pタグの間のマージンも重複しないで同じマージン幅であけることができるので、状況によって便利</p>
<p>ただしマージンの相殺には除外要件があって、下記のようなもの</p>
<blockquote>
<p>Adjoining vertical margins collapse, except:</p>
<ul>
<li>Margins of the root element’s box do not collapse.</li>
<li>If the top and bottom margins of an element with <strong>clearance</strong> are adjoining, its margins collapse with the adjoining margins of following siblings but that resulting margin does not collapse with the bottom margin of the parent block.</li>
</ul>
</blockquote>
<p>さらに、条件が書かれていて</p>
<blockquote>
<p>Two margins are adjoining if and only if:</p>
<ul>
<li>both belong to in-flow block-level boxes that participate in <strong>the same block formatting context</strong></li>
<li>no line boxes, no clearance, no padding and no border separate them (Note that certain zero-height line boxes (see 9.4.2) are ignored for this purpose.)</li>
<li>both belong to vertically-adjacent box edges, i.e. form one of the following pairs:<ul>
<li>top margin of a box and top margin of its first in-flow child</li>
<li>bottom margin of box and top margin of its next in-flow following sibling</li>
<li>bottom margin of a last in-flow child and bottom margin of its parent if the parent has ‘auto’ computed height</li>
<li>top and bottom margins of a box that does not establish a new block formatting context and that has zero computed ‘min-height’, zero or ‘auto’ computed ‘height’, and no in-flow children</li>
</ul>
</li>
</ul>
</blockquote>
<p>と書いてあり、「same block formatting」の中にある要素でないと、マージンの相殺は発生しない。</p>
<p>overflowは<a href="/blog//2012/05/float_and_width_auto/">floatとwidth:auto - メモログ</a>でも触れましたけれど、visible以外の値が設定されている場合は、new block formatting contextsを構築するので、マージンの相殺が発生しなくなる。</p>
<p>上の例の場合だと</p>
<pre><code>&lt;style&gt;
.foo {margin:10px 0 20px 0;}
.bar {margin:25px 0 5px 0; overflow:hidden;}
.baz {margin:20px 0 30px 0;}
&lt;/style&gt;

&lt;h3 class=&quot;foo&quot;&gt;foo&lt;/h3&gt;
&lt;div class=&quot;bar&quot;&gt;
  &lt;p class=&quot;baz&quot;&gt;baz&lt;/p&gt;
&lt;/div&gt;
</code></pre><p>のように、div.barにoverflow:hiddenがつくと、h3.fooとdiv.bar/p.bazとの間のマージンの相殺は行われなくなる（div.barとp.bazとの間の相殺は発生する）。</p>
<p>上のような具体例として、仕様上に下記のように箇条書きされている。</p>
<blockquote>
<p>Note the above rules imply that:</p>
<ul>
<li>Margins between a floated box and any other box do not collapse (not even between a float and its in-flow children).</li>
<li>Margins of elements that establish new block formatting contexts (such as floats and elements with ‘overflow’ other than ‘visible’) do not collapse with their in-flow children.</li>
<li>Margins of absolutely positioned boxes do not collapse (not even with their in-flow children).</li>
<li>Margins of inline-block boxes do not collapse (not even with their in-flow children).</li>
<li>The bottom margin of an in-flow block-level element always collapses with the top margin of its next in-flow block-level sibling, unless that sibling has clearance.</li>
<li>The top margin of an in-flow block element collapses with its first in-flow block-level child’s top margin if the element has no top border, no top padding, and the child has no clearance.</li>
<li>The bottom margin of an in-flow block box with a ‘height’ of ‘auto’ and a ‘min-height’ of zero collapses with its last in-flow block-level child’s bottom margin if the box has no bottom padding and no bottom border and the child’s bottom margin does not collapse with a top margin that has clearance.</li>
<li>A box’s own margins collapse if the ‘min-height’ property is zero, and it has neither top or bottom borders nor top or bottom padding, and it has a ‘height’ of either 0 or ‘auto’, and it does not contain a line box, and all of its in-flow children’s margins (if any) collapse.</li>
</ul>
</blockquote>
<p>clearanceはいわゆるfloat:bothなどを設定した場合に発生するけれど、<a href="http://www.w3.org/TR/CSS21/visuren.html#clearance" target="_blank" rel="noopener">clearanceの仕様</a>には下記のように書かれている。</p>
<blockquote>
<p>Values other than ‘none’ potentially introduce clearance. Clearance inhibits margin collapsing and acts as spacing above the margin-top of an element. It is used to push the element vertically past the float.</p>
<p>Computing the clearance of an element on which ‘clear’ is set is done by first determining the hypothetical position of the element’s top border edge. This position is where the actual top border edge would have been if the element’s ‘clear’ property had been ‘none’.</p>
<p>If this hypothetical position of the element’s top border edge is not past the relevant floats, then clearance is introduced, and margins collapse according to the rules in 8.3.1.</p>
</blockquote>
<p>端的に言うと、clear:bothと書かいても、実際にclearanceが発生しない場合はマージンの相殺は行われる。</p>
</div>
      </article>
    </main>
  </div>
  <script src="/blog/js/lazysizes/lazysizes.min.js" async></script>
<script type="text/javascript">
  // http://css-tricks.com/favicons-next-to-external-links/
  for (const article of document.getElementsByTagName('article')){
    for (const link of article.getElementsByTagName('a')){
      const hostname = link.hostname;
      if (hostname === location.hostname) { continue; }
      link.style.background = `url(http://www.google.com/s2/favicons?domain=${hostname}) 4px center no-repeat`;
      link.style.paddingLeft = '24px';
    }
  }
</script>
</body>
</html>